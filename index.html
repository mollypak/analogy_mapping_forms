<!DOCTYPE html>
<html>
<head>
  <title>Random Grid Survey</title>
  <meta charset="UTF-8">
  <style>
    body { font-family: Arial; max-width: 600px; margin: 40px auto; }
    .row { margin: 10px 0; }
    label { margin-right: 10px; }
  </style>
</head>
<body>

  <h2 id="questionText">Loading...</h2>
  <form id="surveyForm"></form>
  <button onclick="submitSurvey()">Submit</button>

  <script>
    let question; // will hold the randomly chosen question

    fetch("questions.json")
      .then(response => response.json())
      .then(data => {
        // Pick one random question from JSON
        question = data[Math.floor(Math.random() * data.length)];

        document.getElementById("questionText").textContent = question.text;

        const form = document.getElementById("surveyForm");
        question.rows.forEach(row => {
          const div = document.createElement("div");
          div.className = "row";
          div.innerHTML = `<strong>${row}</strong><br>` + question.cols.map(col => `
            <label>
              <input type="radio" name="${row}" value="${col}" required> ${col}
            </label>
          `).join(" ");
          form.appendChild(div);
        });
      });

    function submitSurvey() {
      const responses = {};
      let allFilled = true;

      question.rows.forEach(row => {
        const selected = document.querySelector(`input[name="${row}"]:checked`);
        if (selected) {
          responses[row] = selected.value;
        } else {
          allFilled = false;
        }
      });

      if (!allFilled) {
        alert("Please complete all rows.");
        return;
      }

      fetch("https://script.google.com/macros/s/AKfycbwb91P7wdaNo48lmGUojKZNJHCQTm47Tiili87FMZDJyvPEry-NycrOz5ibfZpwdUXo/exec", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(responses)
      })
      .then(res => res.text())
      .then(txt => alert("Thanks! Submitted."))
      .catch(err => alert("Error: " + err));
    }
  </script>
</body>
</html>
